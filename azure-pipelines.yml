# Android
# Build your Android project with Gradle.
# Add steps that test, sign, and distribute the APK, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/android

trigger:
- master

pool:
  vmImage: 'macos-latest'

steps:
- task: Gradle@2
  inputs:
    workingDirectory: ''
    gradleWrapperFile: 'gradlew'
    gradleOptions: '-Xmx3072m'
    publishJUnitResults: false
    testResultsFiles: '**/TEST-*.xml'
    tasks: 'assembleDebug'
- task: CopyFiles@2
  displayName: 'Copy Files to: $(build.artifactStagingDirectory)'
  inputs:
    SourceFolder: ''
    Contents: '**/*.apk'
    TargetFolder: '$(build.artifactStagingDirectory)'
- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: drop'

- stage: DeployToAppCenter
  jobs:
  - job: Deploy_Android
    displayName: 'Deploy to App Center'
    pool:
      vmImage: 'windows-latest'
    steps:
    - task: DownloadBuildArtifacts@0
      inputs:
        artifactName: 'drop'
        downloadPath: '$(System.ArtifactsDirectory)'
    - script: |
        curl -X POST -H "Content-Type: application/json" -d '{
          "token": "$739256c4c5772f5c2840fa51d4f4912bf62be1c0",
          "file_path": "$(System.ArtifactsDirectory)/app-debug.apk",
          "app_name": "Android-App",
          "group": "Androidapp",
          "release_notes": "Automated build from Azure DevOps"
        }' https://api.appcenter.ms/v0.1/apps/saurabhpathe/Android-App/uploads/releases
      displayName: 'Upload APK to App Center'

